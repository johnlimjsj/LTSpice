* /Users/johnlimjsj/Documents/LTspice/FYP/CIR_CDC.asc
V11 Vdd 0 5
V1 sig 0 PULSE(0 3 0 1n 1n 1m 2m 1)
V3 phi2 0 PULSE(0 3 {t_delay} 1n 1n {t_on+t_offset} {t_period} 1)
V2 phi1 0 PULSE(0 3 {t_delay} 1n 1n {t_on} {t_period} 1)
S1 0 Vxx phi1 0 SW
V4 d0 0 PULSE(0 3 {t_delay+t_on+t_offset*4} 1n 1n {t_on} {t_period} 1)
V5 CONV 0 PULSE(0 3 {t_conv_begin} 1n 1n {t_conv_period} {t_period} 1)
S4 N010 N019 CONV 0 SW
S5 N011 N020 CONV 0 SW
XX1 0 Vdd phi2 N004 com_spdt
XX2 N011 Vxx com_cap params: C={1*c_lsb}
XX3 N010 Vxx com_cap params: C={2*c_lsb}
XX4 0 Vdd b6 N019 com_spdt
XX5 0 Vdd b7 N020 com_spdt
S2 N009 N018 CONV 0 SW
XX6 N009 Vxx com_cap params: C={4*c_lsb}
XX7 0 Vdd b5 N018 com_spdt
S3 N008 N017 CONV 0 SW
XX8 N008 Vxx com_cap params: C={8*c_lsb}
XX9 0 Vdd b4 N017 com_spdt
S6 N007 N016 CONV 0 SW
XX10 N007 Vxx com_cap params: C={16*c_lsb}
XX11 0 Vdd b3 N016 com_spdt
S7 N006 N015 CONV 0 SW
XX12 N006 Vxx com_cap params: C={32*c_lsb}
XX13 0 Vdd b2 N015 com_spdt
S8 N005 N014 CONV 0 SW
XX14 N005 Vxx com_cap params: C={64*c_lsb}
XX15 0 Vdd b1 N014 com_spdt
S9 N003 N013 CONV 0 SW
XX16 N003 Vxx com_cap params: C={128*c_lsb}
XX17 0 Vdd b0 N013 com_spdt
XCsensor N012 N004 Vxx sensor_cap params: Cbase=10n
V6 N012 0 1
XX19 N001 b0 b1 b2 b3 b4 b5 b6 b7 NC_01 com_sar params: T_CONV_BEGIN={t_conv_begin}, T_CONV_PERIOD={t_conv_period}
XComparator N002 Vxx N001 com_comparator
V7 N002 0 1

* block symbol definitions
.subckt com_spdt INV N-INV SIG SW
S1 SW INV N001 0 SW
A1 SIG 0 0 0 0 N001 0 0 BUF
S2 SW N-INV SIG 0 SW
.model SW SW(Ron=10 Roff=10g Vt=0.5)
.ends com_spdt

.subckt com_cap + -
C1 + - {C}
.ic V(+)=0
.ends com_cap

.subckt sensor_cap Vpressure neg pos
C1 pos neg Q={V(Vpressure)*{Cbase}*x}
.ic V(pos)=0
.param Crest 0.1u
.param Cmax 0.8u
.param Cmin 0.12u
.ends sensor_cap

.subckt com_sar CMP b0 b1 b2 b3 b4 b5 b6 b7 RST
V2 CLK4 0 PULSE(0 1 {t_delay+4*t_on} 1n 1n {t_on} {t_period} 1)
V3 CLK5 0 PULSE(0 1 {t_delay+5*t_on} 1n 1n {t_on} {t_period} 1)
V4 CLK6 0 PULSE(0 1 {t_delay+6*t_on} 1n 1n {t_on} {t_period} 1)
V5 CLK7 0 PULSE(0 1 {t_delay+7*t_on} 1n 1n {t_on} {t_period} 1)
V6 CLK0 0 PULSE(0 1 {t_delay} 1n 1n {t_on} {t_period} 1)
V7 CLK1 0 PULSE(0 1 {t_delay+t_on} 1n 1n {t_on} {t_period} 1)
V8 CLK2 0 PULSE(0 1 {t_delay+2*t_on} 1n 1n {t_on} {t_period} 1)
V9 CLK3 0 PULSE(0 1 {t_delay+3*t_on} 1n 1n {t_on} {t_period} 1)
V10 Vref 0 1
XX1 CLK6 CMP COMP6 com_sampleandhold params: C=1u, IC=0
XX2 CLK7 CMP COMP7 com_sampleandhold params: C=1u, IC=0
XX3 CLK2 CMP COMP2 com_sampleandhold params: C=1u, IC=0
XX4 CLK3 CMP COMP3 com_sampleandhold params: C=1u, IC=0
XX5 CLK4 CMP COMP4 com_sampleandhold params: C=1u, IC=0
XX6 CLK5 CMP COMP5 com_sampleandhold params: C=1u, IC=0
XX7 CLK0 CMP COMP0 com_sampleandhold params: C=1u, IC=0
XX8 CLK1 CMP COMP1 com_sampleandhold params: C=1u, IC=0
A2 Vref N001 OFF0 OFF0 OFF0 N002 b0 OFF0 AND
XX10 CLK1 COMP0 N001 com_sampleandhold params: C=1u, IC=1
A11 N003 OFF1 N004 OFF1 OFF1 OFF1 b1 OFF1 AND
XX12 CLK1 Vref N003 com_sampleandhold params: C=1u, IC=0
XX13 CLK2 COMP1 N004 com_sampleandhold params: C=1u, IC=1
A13 N005 OFF2 N006 OFF2 OFF2 OFF2 b2 OFF2 AND
XX17 CLK2 Vref N005 com_sampleandhold params: C=1u, IC=0
XX18 CLK3 COMP2 N006 com_sampleandhold params: C=1u, IC=1
A15 N007 OFF3 N008 OFF3 OFF3 OFF3 b3 OFF3 AND
XX19 CLK3 Vref N007 com_sampleandhold params: C=1u, IC=0
XX20 CLK4 COMP3 N008 com_sampleandhold params: C=1u, IC=1
A17 N009 OFF4 N010 OFF4 OFF4 OFF4 b4 OFF4 AND
XX21 CLK4 Vref N009 com_sampleandhold params: C=1u, IC=0
XX22 CLK5 COMP4 N010 com_sampleandhold params: C=1u, IC=1
A23 N011 OFF5 N012 OFF5 OFF5 OFF5 b5 OFF5 AND
XX23 CLK5 Vref N011 com_sampleandhold params: C=1u, IC=0
XX24 CLK6 COMP5 N012 com_sampleandhold params: C=1u, IC=1
A25 N013 OFF6 N014 OFF6 OFF6 OFF6 b6 OFF6 AND
XX25 CLK6 Vref N013 com_sampleandhold params: C=1u, IC=0
XX26 CLK7 COMP6 N014 com_sampleandhold params: C=1u, IC=1
A27 N015 OFF7 Vref OFF7 OFF7 OFF7 b7 OFF7 AND
XX27 CLK7 Vref N015 com_sampleandhold params: C=1u, IC=0
V16 OFF0 0 {0*SAR_Voffset}
V17 OFF1 0 {1*SAR_Voffset}
V18 OFF2 0 {2*SAR_Voffset}
V19 OFF3 0 {3*SAR_Voffset}
V20 OFF4 0 {4*SAR_Voffset}
V21 OFF5 0 {5*SAR_Voffset}
V22 OFF6 0 {6*SAR_Voffset}
V23 OFF7 0 {7*SAR_Voffset}
V1 COMP_ 0 PULSE(0 1.01 {t_delay} 1n 1n {2*t_on} {4*t_on} 4)
V11 P 0 PWL(1m 1 +1m 0 +1m 1 +1m 0)
.param t_delay {T_CONV_BEGIN}
.param t_conv_period {T_CONV_PERIOD}
.param Nbits 8
.param t_on {t_conv_period/(Nbits*1.1)}
.param t_period 10m
.param c_hold 1u
.param SAR_Voffset 0.02
.param vref 1
.ic V(c0_ic)=0
.model SW SW(Ron=0.01 Roff=10g Vt=0.5 Vh=0)
.lib opamp.sub
.param t1 {t_on+t_delay}
.param t1_delay {t1+0.01*t_on}
.param t2 {2*t_on+t_delay}
.param t_conv 2m  ; {t_conversion}
.ends com_sar

.subckt com_comparator + - OUT
B§1 OUT 0 V={if(V(+)>V(-),1,0)}
.ends com_comparator

.subckt com_sampleandhold SAM VIN OUT
XU1 OUT c0_ic OUT opamp Aol=100K GBW=10Meg
S1 VIN c0_ic SAM 0 SW
C1 c0_ic 0 {C}
.ic V(c0_ic)={IC}
.lib opamp.sub
.model SW SW(Ron=1 Roff=10g Vt=0.5 Vh=0)
.ends com_sampleandhold

.tran {5m} {10m}
.model SW SW(Ron=5 Roff=10g Vt=0.5 Vh=0)
* .ac oct 100 1 10000k
* Analysis Commands
;TIMING
.param t_period 3m
.param t_on 0.5m
.param t_offset 0.1m
.param t_delay 1m
.param t_conv_begin {t_delay+t_on+t_offset*1.05}
.param t_conv_period {t_period+t_offset-t_on}
.param c_lsb 10n
.backanno
.end
